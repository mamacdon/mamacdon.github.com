var eclipse=eclipse||{};eclipse.ServiceProvider=function(a,b){this.dispatchEvent=function(c){b.dispatchEvent.apply(b,[a,c].concat(Array.prototype.slice.call(arguments,1)))},this.unregister=function(){b.unregisterServiceProvider(a)}},eclipse.PluginProvider=function(a){function i(a){if(a.source===e){var b=JSON.parse(a.data),d=b.serviceId,g=c[d].implementation,h=g[b.method],i={id:b.id,result:null,error:null};try{var j=h.apply(g,b.params);j&&typeof j.then=="function"?j.then(function(a){i.result=a,f(i)},function(a){i.error=a,f(i)}):(i.result=j,f(i))}catch(k){i.error=k,f(i)}}}function h(){var a=[];for(var d=0;d<c.length;d++)c[d]&&a.push({serviceId:d,type:c[d].type,methods:c[d].methods,properties:c[d].properties});return{services:a,metadata:b||{}}}function f(a){e&&e.postMessage(JSON.stringify(a),"*")}var b=a,c=[],d=!1,e=null,g={dispatchEvent:function(a,b){if(!d)throw new Error("Cannot dispatchEvent. Plugin Provider not connected");var c={serviceId:a,method:"dispatchEvent",params:[b].concat(Array.prototype.slice.call(arguments,2))};f(c)},unregisterServiceProvider:function(a){if(d)throw new Error("Cannot unregister. Plugin Provider is connected");c[a]=null}};this.registerServiceProvider=function(a,b,e){if(d)throw new Error("Cannot register. Plugin Provider is connected");var f=null,h=[];for(f in b)typeof b[f]=="function"&&h.push(f);var i=c.length;c[i]={type:a,methods:h,implementation:b,properties:e||{}};return new eclipse.ServiceProvider(i,g)},this.connect=function(a,b){if(d)a&&a();else{if(!window)e=self;else if(window!==window.parent)e=window.parent;else if(window.opener!==null)e=window.opener;else{b("No valid plugin target");return}addEventListener("message",i,!1);var c={method:"plugin",params:[h()]};f(c),d=!0,a&&a()}},this.disconnect=function(){d&&(removeEventListener("message",i),e=null,d=!1)}}